# Распределённый вычислитель арифметических выражений

## Описание

Этот проект представляет собой распределённую систему для вычисления арифметических выражений. Выражения разбиваются на отдельные операции, которые выполняются параллельно на нескольких агентных машинах.

## Запуск системы

Для запуска системы используйте `docker-compose`. Убедитесь, что у вас установлен Docker и Docker Compose.

1. Клонируйте репозиторий:
    ```sh
    git clone https://github.com/denis/GOCACL_DISTRIBUTED.git
    cd GOCACL_DISTRIBUTED
    ```

2. Запустите систему:
    ```sh
    docker-compose up --build
    ```

## Примеры использования

### Добавление вычисления арифметического выражения

```sh
curl --location 'localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": "2+2*2"
}'
```

Ответ:
```json
{
    "id": "уникальный идентификатор выражения"
}
```

### Получение списка выражений

```sh
curl --location 'localhost:8080/api/v1/expressions'
```

Ответ:
```json
{
    "expressions": [
        {
            "id": "идентификатор выражения",
            "status": "статус вычисления выражения",
            "result": "результат выражения"
        },
        {
            "id": "идентификатор выражения",
            "status": "статус вычисления выражения",
            "result": "результат выражения"
        }
    ]
}
```

### Получение выражения по его идентификатору

```sh
curl --location 'localhost:8080/api/v1/expressions/:id'
```

Ответ:
```json
{
    "expression": {
        "id": "идентификатор выражения",
        "status": "статус вычисления выражения",
        "result": "результат выражения"
    }
}
```

### Получение задачи для выполнения

```sh
curl --location 'localhost:8080/internal/task'
```

Ответ:
```json
{
    "task": {
        "id": "идентификатор задачи",
        "arg1": "имя первого аргумента",
        "arg2": "имя второго аргумента",
        "operation": "операция",
        "operation_time": "время выполнения операции"
    }
}
```

### Прием результата обработки данных

```sh
curl --location 'localhost:8080/internal/task' \
--header 'Content-Type: application/json' \
--data '{
  "id": "идентификатор задачи",
  "result": 2.5
}'
```

## Схема работы системы

1. Пользователь отправляет арифметическое выражение на сервер.
2. Сервер разбивает выражение на отдельные операции и создает задачи для агентов.
3. Агенты запрашивают задачи у сервера, выполняют их и отправляют результаты обратно на сервер.
4. Сервер собирает результаты и возвращает их пользователю по запросу.

![Схема работы системы](./docs/system_diagram.png)

## Переменные среды

- `TIME_ADDITION_MS` - время выполнения операции сложения в миллисекундах
- `TIME_SUBTRACTION_MS` - время выполнения операции вычитания в миллисекундах
- `TIME_MULTIPLICATIONS_MS` - время выполнения операции умножения в миллисекундах
- `TIME_DIVISIONS_MS` - время выполнения операции деления в миллисекундах
- `COMPUTING_POWER` - количество горутин, выполняющих вычисления на агенте

## Запуск проекта

Для запуска проекта используйте следующую команду:

```sh
go run ./cmd/orchestrator/...
```

## Тестирование

Проект покрыт тестами. Для запуска тестов используйте следующую команду:

```sh
go test ./...
```
